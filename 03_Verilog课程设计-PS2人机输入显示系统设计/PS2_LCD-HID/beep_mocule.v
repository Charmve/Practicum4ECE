//---------------------------------------------------------------------------
//--	æ–‡ä»¶å?	:	Beep_Module.v
//--	ä½œè€?	:	ZIRCON
//--	æè¿°		:	èœ‚é¸£å™¨å‘å£°æ¨¡å?
//--	ä¿®è®¢å†å²	:	2014-1-1
//---------------------------------------------------------------------------
module Beep_Module
(
	//è¾“å…¥ç«¯å£
	CLK_20M,RST_N,KEY,
	//è¾“å‡ºç«¯å£
	BEEP
);

//---------------------------------------------------------------------------
//--	å¤–éƒ¨ç«¯å£å£°æ˜
//---------------------------------------------------------------------------
input					CLK_20M;					//æ—¶é’Ÿçš„ç«¯å?å¼€å‘æ¿ç”¨çš„50MHzæ™¶æŒ¯
input					RST_N;					//å¤ä½çš„ç«¯å?ä½ç”µå¹³å¤ä½?
input 	[ 7:0]	KEY;						//æŒ‰é”®ç«¯å£
output				BEEP;						//èœ‚é¸£å™¨ç«¯å?

//---------------------------------------------------------------------------
//--	å†…éƒ¨ç«¯å£å£°æ˜
//---------------------------------------------------------------------------
reg		[19:0]	time_cnt;				//ç”¨æ¥æ§åˆ¶èœ‚é¸£å™¨å‘å£°é¢‘ç‡çš„å®šæ—¶è®¡æ•°å™?
reg		[19:0]	time_cnt_n;				//time_cntçš„ä¸‹ä¸€ä¸ªçŠ¶æ€?
reg		[15:0]	freq;						//å„ç§éŸ³è°ƒçš„åˆ†é¢‘å€?
reg		[15:0]	freq_n;					//å„ç§éŸ³è°ƒçš„åˆ†é¢‘å€?
reg					beep_reg;				//ç”¨æ¥æ§åˆ¶èœ‚é¸£å™¨å‘å£°çš„å¯„å­˜å™?
reg					beep_reg_n;				//beep_regçš„ä¸‹ä¸€ä¸ªçŠ¶æ€?

//---------------------------------------------------------------------------
//--	é€»è¾‘åŠŸèƒ½å®ç°	
//---------------------------------------------------------------------------
//æ—¶åºç”µè·¯ï¼Œç”¨æ¥ç»™time_cntå¯„å­˜å™¨èµ‹å€?
always @ (posedge CLK_20M or negedge RST_N)
begin
	if(!RST_N)									//åˆ¤æ–­å¤ä½
		time_cnt <= 1'b0;						//åˆå§‹åŒ–time_cntå€?
	else
		time_cnt <= time_cnt_n;				//ç”¨æ¥ç»™time_cntèµ‹å€?
end

//ç»„åˆç”µè·¯,åˆ¤æ–­é¢‘ç‡,è®©å®šæ—¶å™¨ç´¯åŠ  
always @ (*)
begin
	if(time_cnt == freq)						//åˆ¤æ–­åˆ†é¢‘å€?
		time_cnt_n = 1'b0;					//å®šæ—¶å™¨æ¸…é›¶æ“ä½?
	else
		time_cnt_n = time_cnt + 1'b1;		//å®šæ—¶å™¨ç´¯åŠ æ“ä½?

end

//æ—¶åºç”µè·¯ï¼Œç”¨æ¥ç»™beep_regå¯„å­˜å™¨èµ‹å€?
always @ (posedge CLK_20M or negedge RST_N)
begin
	if(!RST_N)									//åˆ¤æ–­å¤ä½
		beep_reg <= 1'b0;						//åˆå§‹åŒ–beep_regå€?
	else
		beep_reg <= beep_reg_n;				//ç”¨æ¥ç»™beep_regèµ‹å€?
end

//ç»„åˆç”µè·¯,åˆ¤æ–­é¢‘ç‡,ä½¿èœ‚é¸£å™¨å‘å£°
always @ (*)
begin
	if(time_cnt == freq)						//åˆ¤æ–­åˆ†é¢‘å€?
		beep_reg_n = ~beep_reg;				//æ”¹å˜èœ‚é¸£å™¨çš„çŠ¶æ€?
	else
		beep_reg_n = beep_reg;				//èœ‚é¸£å™¨çš„çŠ¶æ€ä¿æŒä¸å?
end

//æ—¶åºç”µè·¯ï¼Œç”¨æ¥ç»™beep_regå¯„å­˜å™¨èµ‹å€?
always @ (posedge CLK_20M or negedge RST_N)
begin
	if(!RST_N)									//åˆ¤æ–­å¤ä½
		freq <= 1'b0;							//åˆå§‹åŒ–beep_regå€?
	else
		freq <= freq_n;						//ç”¨æ¥ç»™beep_regèµ‹å€?
end

//ç»„åˆç”µè·¯ï¼ŒæŒ‰é”®é€‰æ‹©åˆ†é¢‘å€¼æ¥å®ç°èœ‚é¸£å™¨å‘å‡ºä¸åŒå£°éŸ?
//ä¸­éŸ³doçš„é¢‘ç‡ä¸º523.3hzï¼Œfreq = 50 * 10^6 / (523 * 2) = 47774
always @ (*)
begin
	case(KEY)
		8'h70: freq_n = 16'd0;			//æ²¡æœ‰å£°éŸ³
		8'h69: freq_n = 16'd47774; 	//ä¸­éŸ³1çš„é¢‘ç‡å€?62Hz
		8'h72: freq_n = 16'd42568; 	//ä¸­éŸ³2çš„é¢‘ç‡å€?87.3Hz
		8'h7A: freq_n = 16'd37919; 	//ä¸­éŸ³3çš„é¢‘ç‡å€?59.3Hz
		8'h6B: freq_n = 16'd35791; 	//ä¸­éŸ³4çš„é¢‘ç‡å€?98.5Hz
		8'h73: freq_n = 16'd31888; 	//ä¸­éŸ³5çš„é¢‘ç‡å€?84Hz
		8'h74: freq_n = 16'd28409; 	//ä¸­éŸ³6çš„é¢‘ç‡å€?80Hz
		8'h6C: freq_n = 16'd25309; 	//ä¸­éŸ³7çš„é¢‘ç‡å€?87.8Hz
		8'h75: freq_n = 16'd23889; 	//é«˜éŸ³1çš„é¢‘ç‡å€?046.5Hz
		8'h7D: freq_n = 16'd21276; 	//é«˜éŸ³2çš„é¢‘ç‡å€?175Hz
		default	  : freq_n = freq;
	endcase
end

assign BEEP = beep_reg;		//æœ€å?å°†å¯„å­˜å™¨çš„å€¼èµ‹å€¼ç»™ç«¯å£BEEP

endmodule



